<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
  <title>移动端HTML文档（富文本）编辑器 - Zx-Editor</title>
  <meta name="keyword" content="Zx-Editor,html-editor,editor">
  <meta name="description" content="移动端HTML文档（富文本）编辑器，支持图文混排、引用、大标题、无序列表，字体颜色、加粗、斜体。">
  <link rel="stylesheet" href="./css/index.css">
  <link rel="stylesheet" href="../../../css/api.css">
</head>
<body>
<div class="container">
  <header class="border-bm">
    <div class="left-wrapper">
      <a href="#" class="back" onclick="handleBackClick()">返回</a>
    </div>
    <div class="title">发布文章</div>
    <div class="right-wrapper">
      <a href="#" class="preview" onclick="handlePreviewClick()">预览</a>
    </div>
  </header>
  <section class="cover-wrapper">
    <div class="cover"><img src=""></div>
    <input type="file" accept="image/*" style="display: none">
  </section>
  <!--标题-->
  <section class="title-wrapper border-bm">
    <div class="item placeholder">标题<span>（不超过30个字）</span></div>
    <div class="item input-hook" contenteditable="true" style="display: none;"></div>
  </section>
  <!--导语、摘要-->
  <section class="summary-wrapper border-bm" style="display: none;">
    <div class="item placeholder">输入导语，140字内（非必填）</div>
    <div class="item input-hook" contenteditable="true" style="display: none;"></div>
  </section>
  <article>
    <div class="zx-eidtor-container" id="editorContainer"></div>
  </article>
</div>

<!--预览-->
<div class="article-preview-wrapper">
  <header class="border-bm">
    <div class="left-wrapper">
      <a href="#" class="back-text" onclick="handleBackPreviewClick()">继续编辑</a>
    </div>
    <div class="right-wrapper">
      <a href="#" class="submit active" onclick="handleSubmitClick()">完成</a>
    </div>
  </header>
  <div class="preview-wrapper">
    <div class="preview-cover"><img src=""></div>
    <div class="preview-title"></div>
    <div class="preview-summary"></div>
    <div class="preveiw-content"></div>
  </div>
</div>
<div class="imgNameReplace" style="display:none;"></div>
<script src="../../../script/api.js"></script>
<script src="../../../script/apiCloud.js"></script>
<script src="../../../script/data.js"></script>
<script src="./js/polyfill.min.js"></script>
<!--exif获取照片参数插件-->
<script src="./libs/exif.min.js"></script>
<!--debug-->
<script src="./libs/zx-debug.min.js"></script>
<!--编辑器-->
<script src="./js/zx-editor.js"></script>
<!--编辑器扩展库-->
<script src="./js/extend.js"></script>
<!--发布文章逻辑-->
<script src="./js/index.js"></script>
<script src="../../../script/public.js"></script>

<script src="https://cdn.bootcss.com/eruda/1.2.6/eruda.js"></script>
<script>eruda.init();</script>
</body>
<script>

  appready=function (fun) {
    if (typeof fun!="function"){return;}
    if(!window.apiready){
      window.apiready = function(){
        var evt = document.createEvent("HTMLEvents");
        evt.initEvent("appready", false, false);
        window.dispatchEvent(evt);
        document.dispatchEvent(evt);
      };
    }
    if (window.api) {
      fun();
    } else {
      window.addEventListener("appready", function() {
        fun();
      })
    }
  }
  window.parent.window.app.appready(function () {

  })

	/*--------向编辑器添加自定义按钮-------*/
	zxEditor.addFooterButton([
		{
			name: 'summary',
			class: 'demo-summary-button',
			icon: '',
			on: 'summary-button'
		},
		{
			name: 'video',
			class: 'demo-video-button',
			icon: '',
			on: 'video-button'
		},
		{
			name: 'audio',
			class: 'demo-audio-button',
			icon: '',
			on: 'audio-button'
		}
	]);
	/*-----------监听编辑器动作-----------*/
	//监听点击添加图片按钮
	zxEditor.on('select-picture', function (callback) {
      api.toast({
        msg:"111"
      })
      var UIAlbumBrowser = api.require('UIAlbumBrowser');
      UIAlbumBrowser.open({
        max: 1,
        styles: {
          bg: '#fff',
          mark: {
            icon: '',
            position: 'bottom_left',
            size: 30
          },
          nav: {
            bg: 'rgba(0,0,0,0.6)',
            titleColor: '#fff',
            titleSize: 18,
            cancelColor: '#fff',
            cancelSize: 16,
            finishColor: '#fff',
            finishSize: 16
          }
        },
        rotation: true
      }, function(ret) {
        if (ret) {
          console.log(ret)
          /*document.querySelector(".info-img-defalut").src = ret.list[0].thumbPath
          var obj = {
            uid : localStorage.getItem("user").user_id
          }
          api.ajax({
            // report : false,
            url:UploadPicon,
            //这里是我们约定好的后台上传图片的位置 ，你可以根据你的需求来改
            method: 'post',
            cache: 'false',
            timeout: 30,
            dataTpye: 'json',
            data: {

              files: {
                file: document.querySelector(".info-img-defalut").src
              },
              values: obj

            }
          }, function (data, err) {

            console.log(data)
          });*/
        }
      });


      // handleCoverWrapper()

      // zxEditor.addImage('http://91gsc.com/img_ftG2P2QKBDYOpRK.jpg');
		// zxEditor.dialog.alert('成功向编辑器中加入图片：http://91gsc.com/img_ftG2P2QKBDYOpRK.jpg,这是一个模拟测试,实际项目中请先将图片上传至后端成功回调后再向编辑器中插入图片地址！', function () {});

	});
	//监听点击添加导语按钮
	zxEditor.on('summary-button', function (prams) {
		zxDebug.log('click summary-button', prams)
		summaryShow = !summaryShow;
		$('.summary-wrapper').style.display = summaryShow ? '' : 'none';
	});
	//监听点击添加视频按钮
	zxEditor.on('video-button', function (prams) {
		//zxDebug.log('click video-button', prams);
		zxEditor.addMedia('http://91gsc.com/%E9%AB%98%E9%80%9F%E5%85%AC%E8%B7%AF%E8%88%AA%E6%8B%8D.mp4', 'video');// img|audio|video
		zxEditor.dialog.alert('成功向编辑器中加入视频：http://91gsc.com/%E9%AB%98%E9%80%9F%E5%85%AC%E8%B7%AF%E8%88%AA%E6%8B%8D.mp4,这是一个模拟测试,实际项目中请先将视频上传至后端成功回调后再向编辑器中插入视频地址！', function () {});
	});
	//监听点击添加音频按钮
	zxEditor.on('audio-button', function (prams) {
		//zxDebug.log('click audio-button', prams);
		zxEditor.addMedia('http://91gsc.com/Audio%20Machine%20-%20Breath%20and%20Life.mp3', 'audio');
		zxEditor.dialog.alert('成功向编辑器中加入音频：http://91gsc.com/Audio%20Machine%20-%20Breath%20and%20Life.mp3,这是一个模拟测试,实际项目中请先将音频上传至后端成功回调后再向编辑器中插入音频地址！', function () {});
	});
	//监听点击添加超链接按钮
	zxEditor.on('add-link', function (next) {
		zxEditor.dialog.alert('可以调用原生接口，获取剪切板url数据', function () {
			//获取原生链接
			next('http://192.168.5.8:81/index.php?s=/12&page_id=1151', '这是一个测试连接地址，如果文字很长会自动省略');
		});
	});
</script>
</html>
