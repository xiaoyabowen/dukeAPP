<!DOCTYPE html>
<html lang="en" class="commonBg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>编辑信息</title>
    <link rel="stylesheet" href="../../../css/api.css"/>
    <link rel="stylesheet" href="../../../css/commonWindow.css"/>
    <link rel="stylesheet" href="../../../css/mineCommon.css"/>
    <link rel="stylesheet" href="../../../css/mui.min.css"/>
    <link rel="stylesheet" href="../../../css/mui.picker.all.css"/>
    <link rel="stylesheet" href="../../../css/mui.dtpicker.css"/>
    <style>
        .my-dynamic-textarea {
            width: 6.3rem !important;
        }

        a {
            display: block;
        }

        textarea {
            border: 0;
            height: 2rem;
        }

        .popover {
            width: 5rem;
            min-height: 3rem;
            padding: 0.2rem;
        }

        .title {
            text-align: center;
            font-size: 0.30rem;
            margin: 0.2rem;
        }

        .btn {
            display: flex;
            justify-content: space-between;
        }

        .btn span {
            display: block;
            color: #638BFF;
        }


    </style>
</head>
<body class="commonBg">
<div class="Box isDisplay">
    <div class="infoBoxSub">
        <div class="info-label">
            <a href="#popover">
                <p class="info-label-title">
                    我的标签
                    <i class="label-remake">（所填内容用，格开为一个标签）</i>
                </p>
                <div class="info-label-choose cssFlex">
                    <span class="info-label-name ellipsis" id="myTags">随性，喜欢简单，敢爱敢恨，欢简单，敢爱欢简单，敢爱萌萌哒，叛逆……</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </a>

            <a href="#popover1">
                <p class="info-label-title">
                    我的兴趣
                    <i class="label-remake">（所填内容用,格开为一个标签）</i>
                </p>
                <div class="info-label-choose cssFlex">
                    <span class="info-label-name ellipsis" id="myInterest">跑步，羽毛球，拳击，效游，读书</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </a>

        </div>
        <div class="info-about">关于我</div>
    </div>
    <div class="F9LineEdit"></div>
    <div class="infoBoxSub">

        <!--请选择-->
        <div class="info-choose cssFlex" onclick="user_p_name()">
            <span class="info-choose-name ellipsis">账户名称</span>
            <div class="info-choose-main cssFlex">
                <span class="info-choose-main-name" id="user_p_name">无</span>
                <img src="../../../icon/right.png" alt="right" class="info-img-right">
            </div>
        </div>

        <div class="info-choose cssFlex" onclick="user_age()">
            <span class="info-choose-name ellipsis"><i class="colorFE" style="color: #FE9114;">*</i>年龄</span>
            <div class="info-choose-main cssFlex">
                <span class="info-choose-main-name birth_option" id="user_age">请选择</span>
                <img src="../../../icon/right.png" alt="right" class="info-img-right">
            </div>
        </div>

        <div class="info-choose cssFlex" onclick="user_sex()">
            <span class="info-choose-name">性别</span>
            <div class="info-choose-main cssFlex">
                <span class="info-choose-main-name" id="user_sex">请选择</span>
                <img src="../../../icon/right.png" alt="right" class="info-img-right">
            </div>
        </div>
        <!--<div class="info-choose cssFlex">
            <span class="info-choose-name">星座</span>
            <div class="info-choose-main cssFlex">
                <span class="info-choose-main-name" id="info-picker-xing">请选择</span>
                &lt;!&ndash;<img src="../../../icon/right.png" alt="right" class="info-img-right">&ndash;&gt;
            </div>
        </div>-->
        <!--<div class="info-choose cssFlex">
            <span class="info-choose-name">职业</span>
            <div class="info-choose-main cssFlex">
                <span class="info-choose-main-name" id="Occupation">请填写</span>
                <img src="../../../icon/right.png" alt="right" class="info-img-right">
            </div>
        </div>-->
        <div class="info-choose cssFlex" onclick="user_jobTimeClick()">
            <span class="info-choose-name ellipsis"><i class="colorFE" style="color: #FE9114;">*</i>开始工作的时间</span>
            <div class="info-choose-main cssFlex">
                <span class="info-choose-main-name birth_option" id="user_jobTime">请选择</span>
                <img src="../../../icon/right.png" alt="right" class="info-img-right">
            </div>
        </div>
        <div class="info-choose cssFlex" onclick="int_city()">
            <span class="info-choose-name ellipsis"><i class="colorFE" style="color: #FE9114;">*</i>居住地</span>
            <div class="info-choose-main cssFlex">
                <span class="info-choose-main-name" id="int_city">请填写</span>
                <span class="isDisplay" id="adr_id">未选择</span>
                <img src="../../../icon/right.png" alt="right" class="info-img-right">
            </div>
        </div>


        <div class="info-choose cssFlex" onclick="emotion()">
            <span class="info-choose-name ">情感状态</span>
            <div class="info-choose-main cssFlex">
                <span class="info-choose-main-name" id="emotion">请选择</span>
                <img src="../../../icon/right.png" alt="right" class="info-img-right">
            </div>
        </div>
        <!--人生观-->
        <!--<div class="info-about">人生观</div>
        <div onclick="love()">
            <div class="info-about-sub">对爱情的看法</div>
            <div class="info-label-choose info-label-cho cssFlex">
                <span class="info-label-name ellipsis" id="love">经历许多，现在只想简简单单，相爱到老。</span>
                <img src="../../../icon/right.png" alt="right" class="info-img-right">
            </div>
        </div>

        <div onclick="cause()">
            <div class="info-about-sub">对事业的看法</div>
            <div class="info-label-choose info-label-cho cssFlex">
                <span class="info-label-name ellipsis" id="cause">三十而立。</span>
                <img src="../../../icon/right.png" alt="right" class="info-img-right">
            </div>
        </div>

        <div onclick="life()">
            <div class="info-about-sub">对生活的看法</div>
            <div class="info-label-choose info-label-cho cssFlex">
                <span class="info-label-name ellipsis" id="life">顺其自然</span>
                <img src="../../../icon/right.png" alt="right" class="info-img-right">
            </div>
        </div>

        <div class="my-dynamic cssFlex">
            <span class="my-dynamic-name">我的动态</span>
            <span class="my-dynamic-send">发布</span>
        </div>
        <div class='textarea-block my-dynamic-block'>
            <textarea class="textarea-item my-dynamic-textarea" name="content" placeholder="请输入内容，不超过50字。"
                      maxlength="500" spellcheck="false"></textarea>
            <div class="textarea-count">
                &lt;!&ndash;<span class="textareaInput">0</span>/<span class="textareaTotal">500</span>&ndash;&gt;
            </div>
        </div>
        <div class="dynamic-link cssFlex">
            <div class="dynamic-img cssFlex">
                <img src="../../../image/mine/photo.png" alt="photo" class="dynamic-photo">
                <span>照片</span>
            </div>
            <div class="dynamic-img cssFlex">
                <img src="../../../image/mine/shipin.png" alt="photo" class="dynamic-photo">
                <span>视频</span>
            </div>
            <div class="dynamic-img cssFlex" onclick="user_addLink()">
                <img src="../../../image/mine/lianjie.png" alt="photo" class="dynamic-photo">
                <span>链接</span>
            </div>
        </div>-->

    </div>
</div>
<div class="showText"></div>

<div id="popover" class="mui-popover popover">
    <div class="title">请填写标签名</div>
    <textarea name="" id="text1" placeholder="所填内容用，格开为一个标签"></textarea>
    <!--<input type="text" placeholder="所填内容用，格开为一个标签',['确定','取消']">-->
    <div class="btn">
        <span onclick="btn_hidden(0)">取消</span>
        <span onclick="btn_hidden(1)">确定</span>
    </div>
</div>

<div id="popover1" class="mui-popover popover">
    <div class="title">请填兴趣签名</div>
    <textarea name="" id="text2" placeholder="所填内容用，格开为一个标签"></textarea>
    <!--<input type="text" placeholder="所填内容用，格开为一个标签',['确定','取消']">-->
    <div class="btn">
        <span onclick="btn_hidden2(0)">取消</span>
        <span onclick="btn_hidden2(1)">确定</span>
    </div>
</div>
<script type="text/javascript" src="../../../script/api.js"></script>
<!--<script type="text/javascript" src="../../../script/util.js"></script>-->
<script type="text/javascript" src="../../../script/rem.js"></script>
<script type="text/javascript" src="../../../script/mui.min.js"></script>
<script type="text/javascript" src="../../../script/mui.picker.js"></script>
<script type="text/javascript" src="../../../script/mui.dtpicker.js"></script>
<script type="text/javascript" src="../../../script/apiCloud.js"></script>
<script type="text/javascript" src="../../../script/public.js"></script>
<script type="text/javascript" src="../../../script/data.js"></script>
<script type="text/javascript" src="../../../script/city.data-3.js"></script>

<!--<script src="https://cdn.bootcss.com/eruda/1.2.6/eruda.js"></script>
    <script>eruda.init();</script>-->
<script>

    var adr_id, p_birthday,url;


    apiready = function () {
        url = api.pageParam.url
        var uid = localStorage.getItem("person_id");
        // console.log(uid);
        ajaxGetWithProgress(QuerySummary, {
            uid: uid
        }, function (data, err) {
            // alert(JSON.stringify(data));
            console.log("editInfo=",data);
            document.querySelector('.Box').classList.remove('isDisplay');
             document.getElementById('user_p_name').innerText = data.p_name || '未填写';

             document.getElementById('user_age').innerText = data.p_birthday || '';

             document.getElementById('user_sex').innerText = data.p_sex || '未选择';

             document.getElementById('user_jobTime').innerText = data.job_from_time || '';

             document.getElementById('adr_id').innerText = data.adr_id || '未选择';

             if (data.province == null || data.city == null || data.street == null) {
                 document.getElementById('int_city').innerText = '未选择';
             }else{
                 document.getElementById('int_city').innerText = data.province + '-' + data.city + '-' +data.street ;
             }


             document.getElementById('emotion').innerText = data.emotion || '未填写';
             // 我的标签
             if (data.p_title) {
                 document.getElementById('myTags').innerHTML = data.p_title;
                 document.getElementById('text1').value = data.p_title;
             }
             // 我的兴趣标签
             if (data.p_hobby) {
                 document.getElementById('myInterest').innerHTML = data.p_hobby;
                 document.getElementById('text2').value = data.p_hobby;
             }

        });

    };

    // 我的标签
    function btn_hidden(index) {
        if (index) {
            var value = document.getElementById('text1').value;
            document.getElementById('myTags').innerText = value;
        }
        mui('.mui-popover').popover('hide');
    }

    // 我的兴趣
    function btn_hidden2(index) {
        if (index) {
            var value = document.getElementById('text2').value;
            document.getElementById('myInterest').innerText = value;
        }
        mui('.mui-popover').popover('hide');
    }

    // 选择出生时间
    function ageChoose() {
        var dtpicker = new mui.DtPicker(
            {
                type: "date", //设置日历初始视图模式
                beginDate: new Date(1950, 04, 25), //设置开始日期
                endDate: new Date() //设置开始日期
            }
        );
        dtpicker.show(function (selectItems) {
            // $(".birth_option").val(selectItems.text)
            document.querySelector(".birth_option").innerText = selectItems.text
        })
    }

    // 开始工作的时间
    function user_jobTimeClick() {
        var dtpicker = new mui.DtPicker(
            {
                type: "date", //设置日历初始视图模式
                beginDate: new Date(1950, 04, 25), //设置开始日期
                endDate: new Date() //设置开始日期
            }
        );
        dtpicker.show(function (selectItems) {
            // $(".birth_option").val(selectItems.text)
            document.getElementById("user_jobTime").innerText = selectItems.text


        })
    }

    // 职业选择
    function Occupation() {
        mui.prompt('', '请填写职位', '请填写职位', ['确定', '取消'], function (e) {
            // console.log(e)
            if (e.index === 0) {
                document.getElementById('Occupation').innerText = e.value;
            }

        }, 'div')
    }

    // 居住地选择
    function int_city() {
        var picker = new mui.PopPicker({
            layer: 3
        });
        picker.setData(cityData3)
        picker.pickers[0].setSelectedIndex(0);
        picker.show(function(SelectedItem) {
            console.log(SelectedItem[0].text);
            document.getElementById("int_city").innerText = SelectedItem[0].text +'-'+ SelectedItem[1].text +'-'+ SelectedItem[2].text;

            var obj = {
                province : SelectedItem[0].text,
                city : SelectedItem[1].text,
                street : SelectedItem[2].text
            }

            ajaxGetWithProgress(addAddressByPerson,obj,function (data) {
                if (data){
                    document.getElementById("adr_id").innerText = data.adr_id
                } else {
                    toast("请求出错")
                }
            })
        })
    }

    // 账户名
    function user_p_name() {
        mui.prompt('', '请填写账户名称', '请填写账户名称', ['确定', '取消'], function (e) {
            console.log(e)

            if (e.index === 0) {
                document.getElementById('user_p_name').innerText = e.value ;
            }
        }, 'div')
    }

    //年龄
    function user_age() {
        var dtpicker = new mui.DtPicker(
            {
                type: "date", //设置日历初始视图模式
                beginDate: new Date(1950, 04, 25), //设置开始日期
                endDate: new Date() //设置开始日期
            }
        );
        dtpicker.show(function (selectItems) {
            console.log(selectItems)
            // $(".birth_option").val(selectItems.text)
            document.getElementById('user_age').innerText = selectItems.text;
        })
    }

    // x性别
    function user_sex() {
        var picker = new mui.PopPicker();
        picker.setData([{
            value: "1",
            text: "男"
        }, {
            value: "2",
            text: "女"
        }
        ])
        picker.pickers[0].setSelectedValue('first', 2000);
        picker.show(function (SelectedItem) {
            document.getElementById('user_sex').innerText = SelectedItem[0].text;
        })
    }

    // 星座选择
    // document.querySelector('#showUserPicker').addEventListener("click", function() {
    //     var picker = new mui.PopPicker();
    //     picker.setData([{
    //         value: "1",
    //         text: "白羊座"
    //     }, {
    //         value: "2",
    //         text: "金牛座"
    //     }, {
    //         value: "3",
    //         text: "双子座"
    //     }, {
    //         value: "4",
    //         text: "巨蟹座"
    //     }, {
    //         value: "5",
    //         text: "狮子座"
    //     }, {
    //         value: "6",
    //         text: "处女座"
    //     }, {
    //         value: "7",
    //         text: "天秤座"
    //     }, {
    //         value: "8",
    //         text: "天蝎座"
    //     }, {
    //         value: "9",
    //         text: "射手座"
    //     }, {
    //         value: "10",
    //         text: "摩羯座"
    //     }, {
    //         value: "11",
    //         text: "水瓶座"
    //     }, {
    //         value: "12",
    //         text: "双鱼座"
    //     }])
    //     //picker.pickers[0].setSelectedIndex(4, 2000);
    //     picker.pickers[0].setSelectedValue('fourth', 2000);
    //     picker.show(function(SelectedItem) {
    //         console.log(SelectedItem);
    //         document.getElementById('info-picker-xing').innerText = SelectedItem[0].text;
    //     })
    // });

    // 情感状态
    function emotion() {
        var picker = new mui.PopPicker();
        picker.setData([{
            value: "first",
            text: "已婚"
        }, {
            value: "second",
            text: "未婚"
        }])
        //picker.pickers[0].setSelectedIndex(4, 2000);
        picker.pickers[0].setSelectedValue('fourth', 2000);
        picker.show(function (SelectedItem) {
            console.log(SelectedItem);
            document.getElementById('emotion').innerText = SelectedItem[0].text;
        })
    }






    // 点击保存执行方法
    function preservation() {
        var person_id = localStorage.getItem('person_id');
        var p_birthday = document.getElementById('user_age').innerText;
        var p_sex = document.getElementById('user_sex').innerText;
        var emotion = document.getElementById('emotion').innerText;
        var p_title = document.getElementById('text1').value;
        var p_hobby = document.getElementById('text2').value;
        var job_from_time = document.getElementById('user_jobTime').innerText;
        var adr_id = document.getElementById('adr_id').innerText;
        var p_name = document.getElementById('user_p_name').innerText;

        if (p_birthday == ""){
            toast("请选择年龄")
            return
        }


        if (job_from_time == ""){
            toast("请选择开始工作时间")
            return
        }

        if (adr_id == "未选择"){
            toast("请选择居住地")
            return
        }

        var obj = {
            person_id: person_id,
            p_birthday: p_birthday,
            p_sex: p_sex,
            emotion: emotion,
            p_title: p_title,
            p_hobby: p_hobby,
            job_from_time: job_from_time,
            adr_id: adr_id,
            p_name: p_name
        }

        console.log(obj);
        ajaxGetWithProgress(CreatePersonUserProfile, obj, function (data, err) {

            // alert(JSON.stringify(data));
            console.log(12344,data);
            if (data.Person_address.return_info.status) {
                // toast('修改个人信息成功');
                api.execScript({
                    name: 'userCenter',
                    frameName:url +"_body",
                    script: 'loadCom()'
                })
                closeWin();
            }

        });
    }

    // $(document).ready(function(){
    //
    //     // var lenInput = $('.textarea-item').val().length;
    //     //
    //     // $(".textarea-item").keyup(function(){
    //     //     lenInput = $(this).val().length;
    //     //     if(lenInput>0 && lenInput<=500){
    //     //         $('.textareaInput').html(lenInput);
    //     //         $('.textarea-btn').attr('disabled',false);
    //     //     }else{
    //     //         $('.textarea-btn').attr('disabled',true);
    //     //     }
    //     // });
    // });

</script>
</body>
</html>
