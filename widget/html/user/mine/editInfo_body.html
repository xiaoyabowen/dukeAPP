<!DOCTYPE html>
<html lang="en" class="commonBg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>编辑信息</title>
    <link rel="stylesheet" href="../../../css/api.css" />
    <link rel="stylesheet" href="../../../css/commonWindow.css" />
    <link rel="stylesheet" href="../../../css/mineCommon.css" />
    <link rel="stylesheet" href="../../../css/mui.min.css" />
    <link rel="stylesheet" href="../../../css/mui.picker.all.css" />
    <link rel="stylesheet" href="../../../css/mui.dtpicker.css" />
    <style>
        .my-dynamic-textarea {
            width: 6.3rem !important;
        }

        a {
            display: block;
        }

        textarea {
            border: 0;
            height: 2rem;
        }

        .popover {
            width: 5rem;
            min-height: 3rem;
            padding: 0.2rem;
        }

        .title {
            text-align: center;
            font-size: 0.30rem;
            margin: 0.2rem;
        }

        .btn {
            display: flex;
            justify-content: space-between;
        }

        .btn span {
            display: block;
            color: #638BFF;
        }


    </style>
</head>
<body class="commonBg">
    <div class="Box isDisplay">
        <div class="infoBoxSub">
            <div class="info-label">
                <a href="#popover">
                    <p class="info-label-title">
                        我的标签
                        <i class="label-remake">（所填内容用，格开为一个标签）</i>
                    </p>
                    <div class="info-label-choose cssFlex">
                        <span class="info-label-name ellipsis" id="myTags">随性，喜欢简单，敢爱敢恨，欢简单，敢爱欢简单，敢爱萌萌哒，叛逆……</span>
                        <img src="../../../icon/right.png" alt="right" class="info-img-right">
                    </div>
                </a>

                <a href="#popover1">
                    <p class="info-label-title">
                        我的兴趣
                        <i class="label-remake">（所填内容用,格开为一个标签）</i>
                    </p>
                    <div class="info-label-choose cssFlex">
                        <span class="info-label-name ellipsis" id="myInterest">跑步，羽毛球，拳击，效游，读书</span>
                        <img src="../../../icon/right.png" alt="right" class="info-img-right">
                    </div>
                </a>

            </div>
            <div class="info-about">关于我</div>
        </div>
        <div class="F9LineEdit"></div>
        <div class="infoBoxSub">

            <!--请选择-->


            <div class="info-choose cssFlex">
                <span class="info-choose-name">年龄</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name birth_option" id="user_age">请选择</span>
                    <!--<img src="../../../icon/right.png" alt="right" class="info-img-right">-->
                </div>
            </div>
            <div class="info-choose cssFlex">
                <span class="info-choose-name">星座</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name" id="info-picker-xing">请选择</span>
                    <!--<img src="../../../icon/right.png" alt="right" class="info-img-right">-->
                </div>
            </div>
            <div class="info-choose cssFlex">
                <span class="info-choose-name">职业</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name" id="Occupation">请填写</span>
                    <!--<img src="../../../icon/right.png" alt="right" class="info-img-right">-->
                </div>
            </div>
            <div class="info-choose cssFlex" onclick="int_city()">
                <span class="info-choose-name">居住地</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name" id="int_city">请填写</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>
            <div class="info-choose cssFlex" onclick="height()">
                <span class="info-choose-name">身高</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name" id="height">请选择 cm</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>
            <div class="info-choose cssFlex" onclick="weight()">
                <span class="info-choose-name">体重</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name" id="weight">请选择 kg</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>
            <div class="info-choose cssFlex" onclick="emotion()">
                <span class="info-choose-name">情感状态</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name" id="emotion">请选择</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>
            <!--人生观-->
            <div class="info-about">人生观</div>
            <div onclick="love()">
                <div class="info-about-sub">对爱情的看法</div>
                <div class="info-label-choose info-label-cho cssFlex">
                    <span class="info-label-name" id="love">经历许多，现在只想简简单单，相爱到老。</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>

            <div onclick="cause()">
                <div class="info-about-sub">对事业的看法</div>
                <div class="info-label-choose info-label-cho cssFlex">
                    <span class="info-label-name" id="cause">三十而立。</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>

            <div onclick="life()">
                <div class="info-about-sub">对生活的看法</div>
                <div class="info-label-choose info-label-cho cssFlex">
                    <span class="info-label-name" id="life">顺其自然</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>

            <div class="my-dynamic cssFlex">
                <span class="my-dynamic-name">我的动态</span>
                <span class="my-dynamic-send">发布</span>
            </div>
            <div class='textarea-block my-dynamic-block'>
                <textarea class="textarea-item my-dynamic-textarea" name="content" placeholder="请输入内容，不超过50字。" maxlength="500" spellcheck="false"></textarea>
                <div class="textarea-count">
                    <!--<span class="textareaInput">0</span>/<span class="textareaTotal">500</span>-->
                </div>
            </div>
            <div class="dynamic-link cssFlex">
                <div class="dynamic-img cssFlex">
                    <img src="../../../image/mine/photo.png" alt="photo" class="dynamic-photo">
                    <span>照片</span>
                </div>
                <div class="dynamic-img cssFlex">
                    <img src="../../../image/mine/shipin.png" alt="photo" class="dynamic-photo">
                    <span>视频</span>
                </div>
                <div class="dynamic-img cssFlex" onclick="user_addLink()">
                    <img src="../../../image/mine/lianjie.png" alt="photo" class="dynamic-photo">
                    <span>链接</span>
                </div>
            </div>
        </div>
    </div>
    <div class="showText"></div>

    <div id="popover" class="mui-popover popover">
        <div class="title">请填写标签名</div>
        <textarea name="" id="text1" placeholder="所填内容用，格开为一个标签"></textarea>
        <!--<input type="text" placeholder="所填内容用，格开为一个标签',['确定','取消']">-->
        <div class="btn">
            <span onclick="btn_hidden(0)">取消</span>
            <span onclick="btn_hidden(1)">确定</span>
        </div>
    </div>

    <div id="popover1" class="mui-popover popover">
        <div class="title">请填兴趣签名</div>
        <textarea name="" id="text2" placeholder="所填内容用，格开为一个标签"></textarea>
        <!--<input type="text" placeholder="所填内容用，格开为一个标签',['确定','取消']">-->
        <div class="btn">
            <span onclick="btn_hidden2(0)">取消</span>
            <span onclick="btn_hidden2(1)">确定</span>
        </div>
    </div>
    <script type="text/javascript" src="../../../script/api.js"></script>
    <!--<script type="text/javascript" src="../../../script/util.js"></script>-->
    <script type="text/javascript" src="../../../script/rem.js"></script>
    <script type="text/javascript" src="../../../script/mui.min.js"></script>
    <script type="text/javascript" src="../../../script/mui.picker.js"></script>
    <script type="text/javascript" src="../../../script/mui.dtpicker.js"></script>
    <script type="text/javascript" src="../../../script/apiCloud.js"></script>
    <script type="text/javascript" src="../../../script/public.js"></script>
    <script type="text/javascript" src="../../../script/data.js"></script>
    <script type="text/javascript" src="../../../script/city.data-3.js"></script>

    <script src="https://cdn.bootcss.com/eruda/1.2.6/eruda.js"></script>
    <script>eruda.init();</script>
    <script>

        var adr_id, p_birthday;


        apiready = function () {
            var adr_id = api.pageParam.adr_id;
            console.log(adr_id);
            var uid = JSON.parse(localStorage.getItem('user')).user_uid;
            // console.log(uid);
            ajaxGetWithProgress(QuerySummary, {
                uid: uid
            }, function (data, err) {
                // alert(JSON.stringify(data));
                console.log(data);
                document.querySelector('.Box').classList.remove('isDisplay');



                if (data.province && data.city && data.street) {
                    document.getElementById('int_city').innerText = data.province +  '-' + data.city + '-' + data.street;
                } else {
                    document.getElementById('int_city').innerText = data.city || '未填写';
                }

                document.getElementById('Occupation').innerText = data.position_type || '未填写';

                document.getElementById('height').innerText = data.height || '未填写';
                document.getElementById('weight').innerText = data.weight || '未填写';
                document.getElementById('emotion').innerText = data.emotion || '未填写';

                // 我的标签
                if (data.p_title) {
                    document.getElementById('myTags').innerHTML = data.p_title;
                    document.getElementById('text1').value = data.p_title;

                }
                // 我的兴趣标签
                if (data.p_hobby) {
                    document.getElementById('myInterest').innerHTML = data.p_hobby;
                    document.getElementById('text2').value = data.p_hobby;
                }

                // 我的年龄,星座
                if (data.p_birthday) {
                    p_birthday = data.p_birthday;
                    var list = data.p_birthday.split('-');
                    console.log(list);
                    var constellation1 = WhatIsYourConstellation(list[0], list[1], list[2]);
                    document.getElementById('user_age').innerText = ages(data.p_birthday);
                    document.getElementById('info-picker-xing').innerText = constellation1
                } else {
                    document.getElementById('user_age').innerText = '未填写';
                    document.getElementById('info-picker-xing').innerText = '未填写';
                }
                // 计算年龄
                function ages(str) {
                    var r = str.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);
                    if (r == null) return false;
                    var d = new Date(r[1], r[3] - 1, r[4]);
                    if (d.getFullYear() == r[1] && (d.getMonth() + 1) == r[3] && d.getDate() == r[4]) {
                        var Y = new Date().getFullYear();
                        // return ("年龄   =   " + (Y - r[1]) + "   周岁");
                        return (Y - r[1]);
                    }
                    return ("输入的日期格式错误！");
                }
                //星座定义
                function WhatIsYourConstellation(y, m, d) {
                    /*
                    判断日期有效性
                    1,3,5,7,8,10,12为31天
                    2月润年29，非润年28
                    4,6,9,11为30天
                    */
                    var daysInMonth = [31, 99, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

                    //检测年份
                    if (y < 1970 || y > 2099) return "年份不对";

                    //检测月份
                    if (m < 1 || m > 12) return "月份不对";

                    //检测日期
                    var mDays = daysInMonth[m - 1];
                    //如果是二月，要根据年份计算天数，不是二月时略过此计算
                    if (m == 2) {
                        mDays = GetSpecialDays(y)
                    }

                    //判断日数据是不是在月份的有效天范围
                    if (d < 0 || d > mDays) return "月份不对";

                    var constellations = [
                        {"Start": 121, "End": 220, "Name": "水平座"}, {"Start": 221, "End": 320, "Name": "双鱼座"},
                        {"Start": 321, "End": 420, "Name": "白羊座"}, {"Start": 421, "End": 520, "Name": "金牛座"},
                        {"Start": 521, "End": 620, "Name": "双子座"}, {"Start": 621, "End": 720, "Name": "巨蟹座"},
                        {"Start": 721, "End": 820, "Name": "狮子座"}, {"Start": 821, "End": 920, "Name": "处女座"},
                        {"Start": 921, "End": 1020, "Name": "天秤座"}, {"Start": 1021, "End": 1120, "Name": "天蝎座"},
                        {"Start": 1121, "End": 1220, "Name": "射手座"}];
                    //好了，走到这一步，说明上面的验证都TM过了。
                    //这才判断是哪一个星座
                    //星座座标等于m*100 + d
                    var pos = m * 100 + Number(d);
                    // console.log(pos);
                    // for (var i in constellations) {
                    //     if (pos >= constellations[i].Start && pos <= constellations[i].End) {
                    //         console.log(123)
                    //         return constellations[i].Name;
                    //     }
                    // }
                    // console.log(constellations)
                    for (var i = 0; i < constellations.length; i++) {
                        if (pos >= constellations[i].Start && pos <= constellations[i].End) {
                            console.log(123)
                            return constellations[i].Name;
                        }
                    }
                }
                //根据年份计算二月天数
                function GetSpecialDays(y) {
                    if (y % 400 == 0 || (y % 4 == 0 && y % 100 != 0)) return 29;
                    return 28;
                }

                // 人生关
                if (data.p_vol) {
                    var list = data.p_vol.split('||');
                    document.getElementById('love').innerText = list[0] || '未填写';
                    document.getElementById('cause').innerText = list[1] || '未填写';
                    document.getElementById('life').innerText = list[2] || '未填写';
                }

            });

        };
        // 我的标签
        function btn_hidden(index) {
            if (index) {
                var value = document.getElementById('text1').value;
                document.getElementById('myTags').innerText = value;
            }
            mui('.mui-popover').popover('hide');
        }
        // 我的兴趣
        function btn_hidden2(index) {
            if (index) {
                var value = document.getElementById('text2').value;
                document.getElementById('myInterest').innerText = value;
            }
            mui('.mui-popover').popover('hide');
        }

        // 选择出生时间
        function ageChoose() {
            var dtpicker = new mui.DtPicker(
                {
                    type: "date", //设置日历初始视图模式
                    beginDate: new Date(1950, 04, 25), //设置开始日期
                    endDate: new Date() //设置开始日期
                }
            );
            dtpicker.show(function (selectItems) {
                // $(".birth_option").val(selectItems.text)
                document.querySelector(".birth_option").innerText = selectItems.text
            })


        }
        // 职业选择
        function Occupation(){
            mui.prompt('','请填写职位','请填写职位',['确定','取消'], function (e) {
                // console.log(e)
                if (e.index === 0) {
                    document.getElementById('Occupation').innerText = e.value;
                }

            },'div')
        }
        // 居住地选择
        function int_city() {
            var picker = new mui.PopPicker({
                layer: 3
            });
            picker.setData(cityData3)
            picker.pickers[0].setSelectedIndex(1);
            picker.show(function(SelectedItem) {
                console.log(SelectedItem);
                var str = SelectedItem[0].text + '-' + SelectedItem[1].text + '-' + SelectedItem[2].text
                document.getElementById("int_city").innerText = str;
            })
        }
        // 身高选择
        function height(){
            mui.prompt('','请填写身高','请填写身高',['确定','取消'], function (e) {
                if (e.index === 0) {
                    document.getElementById('height').innerText = e.value + ' cm';
                }
            },'div')
        }
        // 体重选择
        function weight(){
            mui.prompt('','请填写体重','请填写体重',['确定','取消'], function (e) {
                if (e.index === 0) {
                    document.getElementById('weight').innerText = e.value + ' kg';
                }
            },'div')
        }
        // 星座选择
        // document.querySelector('#showUserPicker').addEventListener("click", function() {
        //     var picker = new mui.PopPicker();
        //     picker.setData([{
        //         value: "1",
        //         text: "白羊座"
        //     }, {
        //         value: "2",
        //         text: "金牛座"
        //     }, {
        //         value: "3",
        //         text: "双子座"
        //     }, {
        //         value: "4",
        //         text: "巨蟹座"
        //     }, {
        //         value: "5",
        //         text: "狮子座"
        //     }, {
        //         value: "6",
        //         text: "处女座"
        //     }, {
        //         value: "7",
        //         text: "天秤座"
        //     }, {
        //         value: "8",
        //         text: "天蝎座"
        //     }, {
        //         value: "9",
        //         text: "射手座"
        //     }, {
        //         value: "10",
        //         text: "摩羯座"
        //     }, {
        //         value: "11",
        //         text: "水瓶座"
        //     }, {
        //         value: "12",
        //         text: "双鱼座"
        //     }])
        //     //picker.pickers[0].setSelectedIndex(4, 2000);
        //     picker.pickers[0].setSelectedValue('fourth', 2000);
        //     picker.show(function(SelectedItem) {
        //         console.log(SelectedItem);
        //         document.getElementById('info-picker-xing').innerText = SelectedItem[0].text;
        //     })
        // });

        // 情感状态
        function emotion(){
            var picker = new mui.PopPicker();
            picker.setData([{
                value: "first",
                text: "已婚"
            }, {
                value: "second",
                text: "未婚"
            }])
            //picker.pickers[0].setSelectedIndex(4, 2000);
            picker.pickers[0].setSelectedValue('fourth', 2000);
            picker.show(function(SelectedItem) {
                console.log(SelectedItem);
                document.getElementById('emotion').innerText = SelectedItem[0].text;
            })
        }

        // 添加链接
        function user_addLink() {
            openNewWindow("user_addLink", "./user_addLink.html", {
                url: 'editInfo',
                content: ''
            });
        }
        function set_user_addLink(value) {
            console.log(value)
        }

        // 对爱情的看法
        function love() {
            mui.prompt('','请填写对爱情的看法','请填写对爱情的看法',['确定','取消'], function (e) {
                // console.log(e)
                if (e.index === 0) {
                    document.getElementById('love').innerText = e.value;
                }

            },'div')
        }
        // 对事业的看法
        function cause() {
            mui.prompt('','请填写对事业的看法','请填写对事业的看法',['确定','取消'], function (e) {
                // console.log(e)
                if (e.index === 0) {
                    document.getElementById('cause').innerText = e.value;
                }

            },'div')
        }
        // 对生活的看法
        function life() {
            mui.prompt('','请填写对生活的看法','请填写对生活的看法',['确定','取消'], function (e) {
                // console.log(e)
                if (e.index === 0) {
                    document.getElementById('life').innerText = e.value;
                }

            },'div')
        }

        // 点击保存执行方法
        function preservation() {
            var love = document.getElementById('love').innerText;
            var cause = document.getElementById('cause').innerText;
            var life = document.getElementById('life').innerText;

            var person_id = localStorage.getItem('person_id');
            var height = document.getElementById('height').innerText;
            var weight = document.getElementById('weight').innerText;
            var emotion = document.getElementById('emotion').innerText;
            var p_title = document.getElementById('text1').value;
            var p_hobby = document.getElementById('text2').value;
            var p_vol = love + '||' + cause + '||' + life;


            var obj = {
                height: height,
                weight: weight,
                emotion: emotion,
                p_title: p_title,
                p_hobby: p_hobby,
                p_vol: p_vol,

                p_birthday: p_birthday,
                person_id: person_id
            }

            console.log(obj);
            ajaxGetWithProgress(UpdatePerson, obj, function (data, err) {

                person_id: person_id
            }, function (data, err) {

                // alert(JSON.stringify(data));
                console.log(data);
                if (data.return_info.status) {
                    toast('修改个人信息成功');

                    api.execScript({
                        name: 'userCenter',
                        // frameName:url +"_body",
                        frameName: 'userCenter_body',
                        script: 'reload()'
                    })
                    closeWin();
                }



            });
        }
        // $(document).ready(function(){
        //
        //     // var lenInput = $('.textarea-item').val().length;
        //     //
        //     // $(".textarea-item").keyup(function(){
        //     //     lenInput = $(this).val().length;
        //     //     if(lenInput>0 && lenInput<=500){
        //     //         $('.textareaInput').html(lenInput);
        //     //         $('.textarea-btn').attr('disabled',false);
        //     //     }else{
        //     //         $('.textarea-btn').attr('disabled',true);
        //     //     }
        //     // });
        // });

    </script>
</body>
</html>
