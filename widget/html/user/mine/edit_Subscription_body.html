<!DOCTYPE html>
<html lang="en" class="commonBg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>修改订阅</title>
    <link rel="stylesheet" href="../../../css/api.css"/>
    <link rel="stylesheet" href="../../../css/commonWindow.css"/>
    <link rel="stylesheet" href="../../../css/mineCommon.css"/>
    <link rel="stylesheet" href="../../../css/mui.min.css">
    <link rel="stylesheet" href="../../../css/mui.picker.all.css"/>
    <link rel="stylesheet" href="../../../css/mui.dtpicker.css"/>
    <!--<script src="https://cdn.bootcss.com/eruda/1.2.6/eruda.js"></script>-->
    <!--<script>eruda.init();</script>-->
    <style>

        .boxSub {
            padding-top: 0.2rem;
        }

        .comon-mine-title {
            font-size: 0.28rem;
            color: #333333;
        }

        div.info-choose {
            height: 1.1rem;
        }

        .info-choose-name {
            font-weight: 500;
            color: #333333;
        }

        .resume_content {
            margin-top: 0;
        }

        labal {
            width: 1.6rem;
            line-height: 0.58rem;
            font-size: 0.28rem;
            color: #333333;
        }

        input[type=text] {
            flex: 1;
            height: 0.58rem;
        }
    </style>

</head>
<body class="commonBg">

<div class="Box">
    <div class="boxSub">
        <div class="comon-mine-title">添加工作经历（第<span id="num">一</span>份）</div>
        <div class="subscriber cssFlex">
            <labal>订阅器名称</labal>
            <input id="text" type="text" maxlength=30>
        </div>
        <div class="resume_content">
            <div class="info-choose cssFlex" onclick="resume_Company()">
                <span class="info-choose-name">公司名称</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name birth_option" id="com_name">请输入</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>

            <div class="info-choose cssFlex" onclick="int_city()">
                <span class="info-choose-name">工作地点</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name birth_option" id="int_city">请选择</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>

            <div class="info-choose cssFlex" onclick="resume_positionType()">
                <span class="info-choose-name">职位类型</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name birth_option" id="position_type">请选择</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>

            <div class="info-choose cssFlex" onclick="resume_CompanyIndustry()">
                <span class="info-choose-name">行业类别</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name birth_option" id="com_type">请选择</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>
            <div class="info-choose cssFlex" onclick="entry_date()">
                <span class="info-choose-name">发布时间</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name quit_date" id="entry_date">请选择</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>

            <div class="info-choose cssFlex" onclick="showUserPicker()">
                <span class="info-choose-name">学历要求</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name education" id="education">请选择</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>
            <div class="info-choose cssFlex" onclick="company_size()">
                <span class="info-choose-name">公司融资规模</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name quit_date" id="company_size">请选择</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>
            <div class="info-choose cssFlex" onclick="team_size()">
                <span class="info-choose-name">公司团队规模</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name quit_date" id="team_size">请选择</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>

            <div class="info-choose cssFlex" onclick="paySelect()">
                <span class="info-choose-name">薪资范围</span>
                <div class="info-choose-main cssFlex">
                    <span class="info-choose-main-name birth_option" id="pay">请选择</span>
                    <img src="../../../icon/right.png" alt="right" class="info-img-right">
                </div>
            </div>

        </div>
    </div>


</div>

<script type="text/javascript" src="../../../script/api.js"></script>
<script type="text/javascript" src="../../../script/rem.js"></script>
<!--<script type="text/javascript" src="../../../script/util.js"></script>-->
<script type="text/javascript" src="../../../script/kv.js"></script>
<script type="text/javascript" src="../../../script/apiCloud.js"></script>
<script type="text/javascript" src="../../../script/public.js"></script>
<script type="text/javascript" src="../../../script/mui.min.js"></script>
<script type="text/javascript" src="../../../script/mui.picker.js"></script>
<script type="text/javascript" src="../../../script/mui.dtpicker.js"></script>
<script type="text/javascript" src="../../../script/data.js"></script>
<script type="text/javascript" src="../../../script/city.data-3.js"></script>

<script src="https://cdn.bootcss.com/eruda/1.2.6/eruda.js"></script>
<script>eruda.init();</script>
<script>

    var url, sub_id;
    apiready = function () {

        url = api.pageParam.url;

        var person_id = localStorage.getItem('person_id');
        ajaxGetWithProgress(QuerySubscriptionById, {
            person_id: person_id
        }, function (data, err) {
            // alert(JSON.stringify(data));
            console.log(data);
            var arr = data.querySubscription;
            if (arr) {
                var item = arr[0];

                sub_id = item.sub_id;
                document.getElementById("text").value = item.sub_name || '请输入';
                document.getElementById("com_name").innerText = item.c_name || '请输入';
                document.getElementById("int_city").innerText = item.job_adr || '请选择';
                document.getElementById("position_type").innerText = item.job_type || '请选择';
                document.getElementById("com_type").innerText = item.com_type || '请选择';
                document.getElementById("company_size").innerText = item.com_scale || '请选择';
                document.getElementById("team_size").innerText = item.com_financing || '请选择';
                document.getElementById("pay").innerText = item.job_ratio || '请选择';
                document.getElementById("entry_date").innerText = item.issue_time || '请选择';
                document.getElementById("education").innerText = item.edu_ex || '请选择';
            }


        });
    };

    // 编辑公司名称
    function resume_Company() {
        var name = document.getElementById("com_name").innerText;
        if (name == '请输入') {
            name = '';
        }
        openNewWindow("resume_Company", "./resume_Company.html", {
            url: 'edit_Subscription',
            content: name
        })
    }
    function com_name(value) {
        // alert(value)
        document.getElementById("com_name").innerText = value;
    }

    // 选择城市
    function int_city() {
        var picker = new mui.PopPicker({
            layer: 3
        });
        picker.setData(cityData3)
        picker.pickers[0].setSelectedIndex(0);
        picker.show(function(SelectedItem) {
            console.log(SelectedItem[0].text);
            document.getElementById("int_city").innerText = SelectedItem[0].text +'-'+ SelectedItem[1].text +'-'+ SelectedItem[2].text;
        })
    }

    // 编辑职位类型
    function resume_positionType() {
        openNewWindow("resume_positionType", "./resume_positionType.html", {
            url: 'edit_Subscription',
            content: document.getElementById("position_type").innerText
        })
    }
    function position_type(value) {
        document.getElementById("position_type").innerText = value;
    }

    // 编辑公司行业
    function resume_CompanyIndustry() {
        openNewWindow("resume_CompanyIndustry", "./resume_CompanyIndustry.html", {
            url: 'edit_Subscription',
            content: document.getElementById("com_type").innerText
        })
    }
    function com_type(value) {
        document.getElementById("com_type").innerText = value;
    }

    // 公司融资规模
    function company_size() {
        var picker = new mui.PopPicker();
        picker.setData([{
            value: "1",
            text: "未融资"
        }, {
            value: "2",
            text: "天使轮"
        }, {
            value: "3",
            text: "A轮"
        }, {
            value: "4",
            text: "B轮"
        }, {
            value: "5",
            text: "C轮"
        }, {
            value: "6",
            text: "D轮及以上"
        },{
            value: "7",
            text: "已上市"
        },{
            value: "8",
            text: "不需要融资"
        },
        ])
        // picker.pickers[0].setSelectedIndex(4, 2000);
        picker.pickers[0].setSelectedValue('first', 2000);
        picker.show(function (SelectedItem) {
            console.log(SelectedItem)
            document.getElementById('company_size').innerText = SelectedItem[0].text;
        })
    }

    // 团队规模
    function team_size() {
        var picker = new mui.PopPicker();
        picker.setData([{
            value: "1",
            text: "0-20人"
        }, {
            value: "2",
            text: "20-99人"
        }, {
            value: "3",
            text: "100-499人"
        }, {
            value: "4",
            text: "500-999人"
        }, {
            value: "5",
            text: "1000-9999人"
        }, {
            value: "6",
            text: "10000人以上"
        },
        ])
        // picker.pickers[0].setSelectedIndex(4, 2000);
        picker.pickers[0].setSelectedValue('first', 2000);
        picker.show(function (SelectedItem) {
            console.log(SelectedItem)
            document.getElementById('team_size').innerText = SelectedItem[0].text;
        })
    }

    // 薪资范围选择
    function paySelect() {
        var picker = new mui.PopPicker();
        picker.setData([{
            value: "1",
            text: "10-15k"
        }, {
            value: "2",
            text: "15-20k"
        }, {
            value: "3",
            text: "20-30k"
        }, {
            value: "4",
            text: "30-50k"
        }, {
            value: "5",
            text: "50-100k"
        }, {
            value: "6",
            text: "100k以上"
        },
        ])
        // picker.pickers[0].setSelectedIndex(4, 2000);
        picker.pickers[0].setSelectedValue('first', 2000);
        picker.show(function (SelectedItem) {
            console.log(SelectedItem)
            document.getElementById('pay').innerText = SelectedItem[0].text;
        })
    }

    // 入学开始
    function entry_date() {
        var dtpicker = new mui.DtPicker(
            {
                type: "date", //设置日历初始视图模式
                beginDate: new Date(1950, 04, 25), //设置开始日期
                endDate: new Date() //设置开始日期
            }
        );
        dtpicker.show(function (selectItems) {
            console.log(selectItems)
            // $(".birth_option").val(selectItems.text)
            document.getElementById('entry_date').innerText = selectItems.text;
        })

    }

    // 学历选择
    function showUserPicker() {
        var picker = new mui.PopPicker();
        picker.setData([{
            value: "first",
            text: "博士"
        }, {
            value: "second",
            text: "研究生"
        }, {
            value: "third",
            text: "本科"
        }, {
            value: "fourth",
            text: "大专"
        }, {
            value: "fifth",
            text: "中专/高中及以下"
        }])
        // picker.pickers[0].setSelectedIndex(4, 2000);
        picker.pickers[0].setSelectedValue('fourth', 2000);
        picker.show(function (SelectedItem) {
            console.log(SelectedItem)
            document.getElementById('education').innerText = SelectedItem[0].text;
        })

    }

    // 点击保存调用的方法
    function preservation() {

        var sub_name = document.getElementById("text").value;
        var c_name = document.getElementById("com_name").innerText;
        var job_adr = document.getElementById("int_city").innerText;
        var job_type = document.getElementById("position_type").innerText;
        var com_type = document.getElementById("com_type").innerText;
        var com_scale = document.getElementById("company_size").innerText;
        var com_financing = document.getElementById("team_size").innerText;
        var job_ratio = document.getElementById("pay").innerText;
        var issue_time = document.getElementById("entry_date").innerText;
        var edu_ex = document.getElementById("education").innerText;


        var person_id = localStorage.getItem('person_id');
        // alert(person_id)
        // console.log(School,major,education,entry_date,quit_date);

        if (sub_name == ""){
            api.toast({
                msg: '请填写订阅器名称'
            });
            return
        }else if(c_name == "请输入"){
            api.toast({
                msg: '请填写公司名称'
            });
            return
        }else if(job_adr == "请选择"){
            api.toast({
                msg: '请选择工作地址'
            });
            return
        }else if(job_type == "请选择"){
            api.toast({
                msg: '请选择职位类型'
            });
            return
        }else if(com_type == "请选择"){
            api.toast({
                msg: '请选择行业类型'
            });
            return
        }else if(edu_ex == "请选择"){
            api.toast({
                msg: '请选择学历'
            });
            return
        }else if(issue_time == "请选择"){
            api.toast({
                msg: '请选择入职时间'
            });
            return
        }else if(com_scale == "请选择"){
            api.toast({
                msg: '请选择公司融资规模'
            });
            return
        }else if(com_financing == "请选择"){
            api.toast({
                msg: '请选择公司团队规模'
            });
            return
        }else if(job_ratio == "请选择"){
            api.toast({
                msg: '请选择薪资范围'
            });
            return
        }



        var params = {
            sub_id: sub_id,
            sub_name: sub_name ,
            c_name: c_name ,
            job_adr: job_adr ,
            job_type: job_type ,
            com_type: com_type ,
            com_scale: com_scale ,
            com_financing: com_financing ,
            job_ratio: job_ratio ,
            issue_time: issue_time ,
            edu_ex: edu_ex ,
        }
        console.log(params);

        ajaxGetWithProgress(UpdateSubscriptionById, params, function (data, err) {
            // alert(JSON.stringify(data));
            console.log(data);
            if (data.return.status) {
                toast('修改成功')
                var frameName = url +"_body";
                api.execScript({
                    name:url,
                    // frameName:url +"_body",
                    frameName: frameName,
                    script: 'reset()'
                })
                closeWin();
                return;
            }
            toast('修改失败')

        });
    }

    // 此处手动调用了js
    // apiready()


</script>
</body>
</html>
